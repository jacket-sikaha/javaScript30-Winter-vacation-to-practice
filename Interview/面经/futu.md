# futu

## 2026-2-4

### httpåè®®çŸ¥é“å¤šå°‘ï¼Ÿhttp2 ï¼Œhttp3æœ‰äº†è§£è¿‡å—

#### åŸºç¡€

1. åè®®æœ¬è´¨
   æ— çŠ¶æ€åè®®ï¼šæ¯æ¬¡è¯·æ±‚ç‹¬ç«‹ï¼ŒæœåŠ¡å™¨ä¸ä¿ç•™ä¸Šä¸‹æ–‡ï¼ˆé€šè¿‡Cookie/Sessionæ¨¡æ‹ŸçŠ¶æ€ï¼‰
   åº”ç”¨å±‚åè®®ï¼šåŸºäºŽTCPï¼ˆHTTP/1/2ï¼‰æˆ–UDPï¼ˆHTTP/3ï¼‰çš„è¯·æ±‚-å“åº”æ¨¡åž‹
   æ˜Žæ–‡ä¼ è¾“ï¼ˆHTTPï¼‰ vs åŠ å¯†ä¼ è¾“ï¼ˆHTTPS = HTTP + TLSï¼‰

##### http1 ç‰¹ç‚¹

1. æŒä¹…è¿žæŽ¥Connection: keep-alive å¤ç”¨TCPè¿žæŽ¥
2. ETag/Last-Modified + Cache-Control ç¼“å­˜æŽ§åˆ¶
3. æ— è¿žæŽ¥ï¼šæ¯ä¸ªè¯·æ±‚å®ŒæˆåŽç«‹å³å…³é—­è¿žæŽ¥

- å…³é”®ç—›ç‚¹ï¼šé˜Ÿå¤´é˜»å¡žï¼ˆHOL Blockingï¼‰
  å•TCPè¿žæŽ¥ä¸­ï¼Œå‰ä¸€ä¸ªè¯·æ±‚æœªå®Œæˆæ—¶ï¼ŒåŽç»­è¯·æ±‚å¿…é¡»ç­‰å¾…ï¼ˆå³ä½¿èµ„æºå·²å°±ç»ªï¼‰

##### HTTP/2 ç‰¹ç‚¹

æ ¸å¿ƒæ”¹è¿›ï¼ˆåŸºäºŽTCP + TLSå¼ºåˆ¶åŠ å¯†ï¼‰

å¤šè·¯å¤ç”¨ å•TCPè¿žæŽ¥æ‰¿è½½å¤šæµï¼ˆStreamï¼‰ï¼Œå¸§å¸¦Stream ID å½»åº•è§£å†³åº”ç”¨å±‚é˜Ÿå¤´é˜»å¡ž
å¤´éƒ¨åŽ‹ç¼© HPACKç®—æ³•ï¼ˆé™æ€/åŠ¨æ€å­—å…¸+Huffmanç¼–ç ï¼‰ å¤´éƒ¨ä½“ç§¯å‡å°‘80%+ï¼ˆå°¤å…¶å¯¹ç§»åŠ¨ç«¯ï¼‰

- æœªè§£å†³çš„é—®é¢˜
  TCPå±‚é˜Ÿå¤´é˜»å¡žï¼šå•ä¸ªTCPåŒ…ä¸¢å¤± â†’ æ•´ä¸ªè¿žæŽ¥æš‚åœé‡ä¼ ï¼ˆå½±å“æ‰€æœ‰Streamï¼‰
  è¿žæŽ¥å»ºç«‹å¼€é”€ï¼šTLS 1.2éœ€2-RTTï¼ˆTLS 1.3ä¼˜åŒ–è‡³1-RTTï¼‰

##### HTTP/3 ç‰¹ç‚¹

ä¼ è¾“å±‚é‡æž„ QUICåè®®æ›¿ä»£TCP
HTTP/1.1ï¼ˆåº”ç”¨å±‚å µï¼‰â†’ HTTP/2ï¼ˆTCPå±‚å µï¼‰â†’ HTTP/3ï¼ˆå½»åº•æ— å µï¼‰

ðŸŒ ä¸‰ç‰ˆæœ¬é€Ÿè®°è¡¨
| ç‰ˆæœ¬ | ä¼ è¾“å±‚ | æ ¸å¿ƒçªç ´ | è‡´å‘½çŸ­æ¿ | è®°å¿†å…³é”®è¯ |
|------|--------|----------|----------|------------|
| HTTP/1.1 | TCP | æŒä¹…è¿žæŽ¥ | ä¸²è¡Œè¯·æ±‚ï¼Œåº”ç”¨å±‚é˜Ÿå¤´é˜»å¡ž | `Keep-Alive` |
| HTTP/2 | TCP+TLS | å¤šè·¯å¤ç”¨ï¼ˆå•è¿žæŽ¥å¹¶å‘ï¼‰ | TCPä¸¢åŒ…â†’å…¨è¿žæŽ¥é˜»å¡ž | `äºŒè¿›åˆ¶å¸§` |
| HTTP/3 | QUIC (UDP+TLS1.3) | æµçº§ç‹¬ç«‹ï¼ˆä¸¢åŒ…åªå½±å“å•æµï¼‰ | é˜²ç«å¢™å¯èƒ½æ‹¦æˆªUDP | `æ— ç¼åˆ‡æ¢ç½‘ç»œ` |

ðŸ’¡ 3å¥å£è¯€ç§’è®°
1.1å µåœ¨è¯·æ±‚ï¼ˆä¸²è¡Œç­‰å“åº”ï¼‰
2.0å µåœ¨TCPï¼ˆä¸¢1åŒ…ï¼Œå…¨æµåœï¼‰
3.0å µä¸ä½ï¼ˆQUICæµç‹¬ç«‹ + 0-RTTå¿«è¿žï¼‰

### react vue åŒºåˆ«,èƒ½ç®€å•è¯´è¯´å—

| ç»´åº¦     | React                                 | Vue                                                           |
| -------- | ------------------------------------- | ------------------------------------------------------------- |
| æ ¸å¿ƒç†å¿µ | â€œåº“â€ï¼šä¸“æ³¨è§†å›¾å±‚ï¼Œç”Ÿæ€è‡ªç”±ç»„åˆ        | â€œæ¡†æž¶â€ï¼šæ¸è¿›å¼å…¨å®¶æ¡¶ï¼ˆRouter/Vuex/Piniaï¼‰                     |
| å†™æ³•     | JSXï¼ˆJS+HTMLèžåˆï¼‰ï¼Œé€»è¾‘è§†å›¾ä¸€ä½“      | æ¨¡æ¿è¯­æ³•ï¼ˆHTML-likeï¼‰ï¼Œé€»è¾‘è§†å›¾åˆ†ç¦»ï¼ˆComposition APIå¯é€‰JSXï¼‰ |
| å“åº”å¼   | æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼ˆ`setState`/`useState`ï¼‰ | æ•°æ®åŠ«æŒï¼ˆProxyï¼‰ï¼Œæ”¹æ•°æ®â†’è‡ªåŠ¨æ›´æ–°                            |
| å­¦ä¹ æ›²çº¿ | æ¦‚å¿µå¤šï¼ˆJSX/Hooks/ç”Ÿæ€é€‰åž‹ï¼‰          | æ¨¡æ¿ç›´è§‚ï¼Œæ–‡æ¡£å‹å¥½ï¼Œä¸Šæ‰‹æ›´å¿«                                  |
| æ›´æ–°ä¼˜åŒ– | éœ€æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆ`React.memo`ï¼‰            | ç¼–è¯‘æ—¶+è¿è¡Œæ—¶è‡ªåŠ¨ä¼˜åŒ–ï¼ˆç»†ç²’åº¦æ›´æ–°ï¼‰                           |
| TSæ”¯æŒ   | ç¤¾åŒºå®Œå–„                              | Vue 3åŽŸç”ŸTSé‡å†™ï¼Œä½“éªŒæ›´ä¸æ»‘                                   |

### ä¸ºä»€ä¹ˆhookä¸èƒ½ç”¨åœ¨if åˆ¤æ–­è¯­å¥ä¸­

```js
// æ¯ä¸ªç»„ä»¶å®žä¾‹ç»´æŠ¤ä¸€ä¸ª Hook é“¾è¡¨
fiber.memoizedState = {
  baseState: 0, // count çš„çŠ¶æ€
  next: {
    baseState: "", // name çš„çŠ¶æ€
    next: null,
  },
};

// æ¸²æŸ“æ—¶åŒ¹é…é€»è¾‘
function useState(initial) {
  const hookIndex = currentHookIndex++; // æ¯æ¬¡è°ƒç”¨è‡ªå¢ž
  const hook = getHookByIndex(hookIndex); // æŒ‰ç´¢å¼•å–èŠ‚ç‚¹

  if (isFirstRender) {
    hook.memoizedState = initial; // é¦–æ¬¡åˆ›å»º
  }
  return [hook.memoizedState, dispatch];
}
```

å…³é”®ï¼šhookIndex æ˜¯å”¯ä¸€å…³è”ä¾æ®ï¼

âŒ æ¡ä»¶æ”¹å˜ â†’ ç´¢å¼•é”™ä½ â†’ çŠ¶æ€å¼ å† æŽæˆ´
a b c hook ï¼Œç¬¬äºŒæ¬¡æ›´æ–°æ¸²æŸ“ b æ²¡æœ‰æ‰§è¡Œï¼Œhook c æŒ‰ç…§hookIndexå°±æ‹¿åˆ°äº†bçš„hook å¯¼è‡´çŠ¶æ€é”™è¯¯

### viteå†·å¯åŠ¨ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«

- webpack æ˜¯å…¨é‡æ‰“åŒ…åŒ…æ‹¬nodemoduleä¾èµ– vite é¢„æž„å»ºä¾èµ– ä¸æ‰“åŒ…

ä¸ºä»€ä¹ˆä¸æ‰“åŒ…

- ESM æ”¯æŒ
- esbuild é¢„æž„å»º
- æŒ‰éœ€ç¼–è¯‘ æµè§ˆå™¨åªç¼–è¯‘åŠ è½½æ‰€éœ€è¦çš„js
- æ™ºèƒ½ç¼“å­˜ é¢„æž„å»ºç»“æžœå­˜ .vite/depsï¼Œä¾èµ–ä¸å˜ç›´æŽ¥å¤ç”¨

### Content-Type

å†³å®šå†…å®¹è§£æž ï¼Œå‘Šè¯‰å¯¹æ–¹ â€œå†…å®¹æ˜¯ä»€ä¹ˆç±»åž‹â€ï¼ŒæŒ‡å¯¼å¦‚ä½•è§£æž

### Keep-Alive

å¤ç”¨TCPè¿žæŽ¥ï¼Œé¿å…æ¯æ¬¡è¯·æ±‚é‡å»ºè¿žæŽ¥ï¼ˆå‡å°‘æ¡æ‰‹å¼€é”€ï¼‰
HTTP/1.1é»˜è®¤ç”Ÿæ•ˆï¼Œæ¡†æž¶/æœåŠ¡å™¨å·²ä¼˜åŒ–

### é¢„æ£€è¯·æ±‚ï¼ˆPreflight Requestï¼‰

ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘

- PUT/DELETE
- Content-Type: application/json
- è‡ªå®šä¹‰å¤´ï¼ˆå¦‚ Authorization: Bearer xxxï¼‰

ä¸ºä»€ä¹ˆè¦æœ‰é¢„æ£€è¯·æ±‚---ä¿æŠ¤æœåŠ¡å™¨å…å—æœªçŸ¥è·¨åŸŸé£Žé™© ä¸ºäº†å®‰å…¨
é˜²æ­¢CSRFæ”»å‡»ï¼Œæ¶æ„è¯·æ±‚é¢„æ£€ä¼šè¢«æœåŠ¡å™¨æ‹’ç»
æµè§ˆå™¨å¯¹ â€œéžç®€å•è¯·æ±‚â€ï¼ˆå¯èƒ½å¯¹æœåŠ¡å™¨æ•°æ®äº§ç”Ÿè¾ƒå¤§å½±å“çš„è¯·æ±‚ï¼‰ä¼šæ ¼å¤–è°¨æ…Ž

### viteæ€Žä¹ˆè§£å†³å¾ªçŽ¯ä¾èµ–

aå¼•ç”¨b bå¼•ç”¨aï¼Œé¡¶å±‚æ¨¡å—ä½œç”¨åŸŸç›´æŽ¥æ‰“å°è¿™ä¸ªå˜é‡ï¼Œç›´æŽ¥ä½¿ç”¨ä¼šå‡ºçŽ°å˜é‡æœªåˆå§‹åŒ–æŠ¥é”™
å°†å…¬å…±çš„å¸¸é‡å˜é‡ç»Ÿä¸€åœ¨ä¸€ä¸ªæ–‡ä»¶å¯¼å‡ºï¼Œåªæœ‰ä»–å¯¼å‡ºç»™å…¶ä»–æ–‡ä»¶ç”¨ï¼Œä¸å«ä»»ä½•import
å†™ä¾èµ–åŒ…æ—¶å€™ï¼Œæ‰€æœ‰æ–‡ä»¶ä¸å…è®¸ç›´æŽ¥é€šè¿‡å…¥å£æ–‡ä»¶è·¯å¾„importå…¶ä»–æ–‡ä»¶,å®¹æ˜“å¾ªçŽ¯ä¾èµ–
a ==> index ==> b
a <== index <== b
